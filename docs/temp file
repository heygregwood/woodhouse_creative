Claude’s Plan
Vercel Deployment Compatibility Analysis
Executive Summary
After comprehensive analysis of the entire codebase, 13 out of 21 API routes and 53+ Python scripts will NOT work on Vercel production deployment. The primary blockers are:

Python script execution via subprocess spawning (4 critical routes)
SQLite write operations to read-only filesystem (6 routes)
File system writes for logs and templates (2 operations)
CRITICAL BLOCKERS (Will Fail on Vercel)
1. Python Script Execution (4 API Routes) ❌
These routes spawn Python processes that won't exist in Vercel's serverless environment:

/api/admin/sync-excel - CRITICAL BLOCKER
File: app/api/admin/sync-excel/route.ts

Lines: 31, 261, 290
Python Scripts Called:
scripts/sync_from_excel.py - Reads Excel from OneDrive, syncs to SQLite
scripts/add_dealer_to_spreadsheet.py - Adds dealer column to Google Sheets
scripts/email_sender/send_email.py - Sends welcome/FB admin emails
Error: spawn python3 ENOENT
Impact: Cannot sync new dealers from Allied Excel
/api/admin/process-done - CRITICAL BLOCKER
File: app/api/admin/process-done/route.ts

Lines: 14, 213
Python Script: scripts/email_sender/send_email.py
Error: spawn python3 ENOENT
Impact: Cannot send scheduled post emails to dealers
/api/admin/dealer-review - CRITICAL BLOCKER
File: app/api/admin/dealer-review/route.ts

Lines: 13, 153, 190
Python Scripts Called:
scripts/add_dealer_to_spreadsheet.py
scripts/email_sender/send_email.py
Error: spawn python3 ENOENT
Impact: Cannot approve promoted dealers or send FB admin emails
/api/admin/send-welcome-email - BLOCKER
File: app/api/admin/send-welcome-email/route.ts

Lines: 9, 27
Python Script: scripts/email_sender/send_email.py
Error: spawn python3 ENOENT
Impact: Cannot manually send welcome emails
2. SQLite Write Operations (6 API Routes) ❌
Vercel's filesystem is read-only. These routes try to write to data/sqlite/creative.db:

/api/admin/submit-post ❌
File: app/api/admin/submit-post/route.ts

Lines: 178-196
Operation: CREATE TABLE IF NOT EXISTS posts + INSERT OR REPLACE
Impact: Cannot save new posts to archive
/api/admin/dealer-status ❌
File: app/api/admin/dealer-status/route.ts

Lines: 233, 259, 289
Operation: UPDATE dealers SET program_status = ?
Impact: Cannot promote/demote dealers between CONTENT and FULL
/api/admin/process-done ❌
File: app/api/admin/process-done/route.ts

Lines: 175-186
Operation: UPDATE dealers SET first_post_email_sent = ?, last_post_email_sent = ?
Impact: Cannot track email send timestamps
/api/admin/save-logo ❌
File: app/api/admin/save-logo/route.ts

Line: 82
Operation: UPDATE dealers SET creatomate_logo = ?
Impact: Cannot save selected logos
/api/admin/dealer-review ❌
File: app/api/admin/dealer-review/route.ts

Lines: 113-125
Operation: Multiple UPDATE operations for dealer approval
Impact: Cannot approve dealers after review
/api/admin/mark-needs-design ❌
File: app/api/admin/mark-needs-design/route.ts

Operation: UPDATE dealers SET logo_needs_design = ?
Impact: Cannot flag dealers needing logo redesign
3. File System Writes (2 Operations) ❌
Email Template Editing ❌
File: app/api/admin/email-templates/route.ts

Line: 118
Operation: fs.writeFile(filePath, content, 'utf-8')
Path: templates/emails/{templateName}.html
Impact: Cannot edit email templates from dashboard
Log File Writing ❌
File: scripts/batch_render.py

Lines: 400-415
Operation: Writes to logs/batch_render_{post}_{timestamp}.log
Impact: Batch render logs not saved (minor - informational only)
WORKING ON VERCEL (No Changes Needed) ✅
SQLite READ Operations (8 routes) ✅
These will work IF the database file is bundled at build time:

/api/admin/dealers - Queries dealer list
/api/admin/fetch-logos - Gets dealer website/logo
/api/admin/send-batch-emails - Gets dealer email data
/api/cron/process-render-queue - Gets dealer data for rendering
/api/creative/render-batch - Fetches FULL dealers
Caveat: Data becomes stale after deployment. Any updates via Python scripts won't be reflected.

Cloud API Operations (11 routes) ✅
These use cloud services and work perfectly on Vercel:

Google Drive API (lib/google-drive.ts) - Upload videos, create folders, archive files
Creatomate API (lib/creatomate.ts) - Video rendering, webhook verification
Firebase Firestore (lib/renderQueue.ts) - Render job tracking, batch management
Google Sheets API - Spreadsheet reads (via Python scripts - blocked) and some TypeScript implementations
Resend API - Email delivery (via Python scripts - blocked)
Brandfetch API - Logo fetching
Microsoft Graph API (lib/sync-excel.ts) - SharePoint Excel reading (implemented but unused)
Webhook Handlers ✅
/api/webhooks/creatomate - Receives render completion notifications
ADMIN DASHBOARD FEATURE IMPACT
/admin - Main Dashboard
Feature	Status	Impact
Sync from Excel	❌ FAILS	Cannot sync new dealers from Allied Excel
Batch Video Render	⚠️ PARTIAL	Can start renders, but dealer data is stale
Populate Post Copy	❌ FAILS	Depends on Python spreadsheet sync
Process Scheduled Emails	❌ FAILS	Cannot send emails (Python script)
Quick Stats	⚠️ STALE	Shows last build-time data
/admin/posts - Post Workflow
Feature	Status	Impact
Submit New Post	❌ FAILS	Cannot write to SQLite
Dealer Status Table	⚠️ STALE	Shows last spreadsheet sync from localhost
Send Batch Emails	❌ FAILS	Depends on Python script
Auto-refresh	⚠️ STALE	Fetches stale data every 30 seconds
/admin/dealer-review - Dealer Review
Feature	Status	Impact
List Pending Dealers	⚠️ STALE	Shows dealers from last localhost sync
Approve Dealer	❌ FAILS	Cannot update SQLite or call Python scripts
Find Logo	✅ WORKS	Brandfetch API works
Save Logo to Staging	✅ WORKS	Uploads to Google Drive
/admin/email-templates - Email Templates
Feature	Status	Impact
List Templates	✅ WORKS	Reads from bundled templates at build time
Edit Template	❌ FAILS	Cannot write to filesystem
Preview Template	✅ WORKS	Client-side rendering
SUMMARY TABLE
Category	Localhost	Vercel Production
Python Scripts	✅ Works	❌ Fails (no Python runtime)
SQLite Reads	✅ Works	⚠️ Stale data (bundled at build)
SQLite Writes	✅ Works	❌ Fails (read-only FS)
File Writes	✅ Works	❌ Fails (read-only FS)
Cloud APIs	✅ Works	✅ Works
Firestore	✅ Works	✅ Works
Google Drive	✅ Works	✅ Works
Creatomate	✅ Works	✅ Works
AFFECTED ADMIN FEATURES
COMPLETELY BROKEN on Vercel ❌
Sync from Excel → Add new dealers
Process scheduled emails → Send post notifications
Approve promoted dealers → Add to spreadsheet + send FB admin email
Submit new post → Save to database
Edit email templates → Save changes
PARTIALLY WORKING (Stale Data) ⚠️
Batch render → Can start renders with stale dealer data
Dealer status table → Shows outdated status
Quick stats → Shows build-time dealer count
Dealer review list → Shows stale pending dealers
FULLY WORKING ✅
Logo finder → Brandfetch API + web scraping
Logo staging → Upload to Google Drive with PNG conversion
Render batch tracking → Firestore-based
Webhook handling → Creatomate completion notifications
PYTHON SCRIPTS INVENTORY
Total: 53+ Python scripts in /scripts/ directory

Critical Scripts (Called by API Routes)
sync_from_excel.py - Syncs Allied Excel to SQLite
email_sender/send_email.py - Sends emails via Resend + updates spreadsheet
add_dealer_to_spreadsheet.py - Adds dealer column to Google Sheets
batch_render.py - Batch video rendering (CLI only, not called by API)
Data Import/Management Scripts
import_creatomate_validated.py
verify_logos.py
crawl_websites.py
update_dealer_status.py
process_done_status.py
sync_spreadsheet.py
export_full_dealers.py
... and 40+ more
All of these require Python runtime and local file access, which Vercel doesn't provide.

EXISTING MIGRATION WORK
Already Implemented (Not Used)
File: lib/sync-excel.ts

TypeScript implementation of Excel sync using Microsoft Graph API
Attempts to read Excel from SharePoint
Status: Failed due to Excel API permission limitations
Issue: Excel workbook endpoints require delegated permissions (user context), not supported with app-only authentication
Note: File download with xlsx library parsing also failed with same error
RECOMMENDED MIGRATION STRATEGY
Phase 1: Migrate Python Email Script to TypeScript
Priority: CRITICAL (blocks 4 routes)

Convert scripts/email_sender/send_email.py to TypeScript:

Use Resend SDK for Node.js
Use Google Sheets API for spreadsheet updates
Replace all subprocess calls with direct TypeScript imports
Files to Create:

lib/email-sender.ts - Core email sending logic
Update routes: sync-excel, process-done, dealer-review, send-welcome-email
Phase 2: Migrate SQLite to Firestore
Priority: HIGH (blocks 6 routes)

Create Firestore collections:

dealers - All dealer data
posts - Post archive
dealer_contacts - Contact tracking
removed_dealers - Historical archive
Files to Update:

All API routes using Database(DB_PATH)
Create lib/firestore-dealers.ts helper library
Phase 3: Convert Google Sheets Scripts to TypeScript
Priority: MEDIUM (blocks dealer approval flow)

Convert scripts/add_dealer_to_spreadsheet.py:

Use Google Sheets API v4 for Node.js
Direct spreadsheet column insertion
No subprocess spawning
Phase 4: Email Templates to Firestore/Build-Time
Priority: LOW (editing works on localhost)

Options:

Store templates in Firestore collection email_templates
Bundle templates at build time (read-only in production)
Use environment variables for template content
Phase 5: Logging to Cloud Service
Priority: LOW (informational only)

Replace file logging with:

Vercel's built-in logging
Or cloud service (Datadog, Google Cloud Logging)
NOTES
The codebase already has good separation between cloud APIs (working) and local operations (broken)
Firestore is already used for render queue - established pattern to follow
The SQLite database is 124 dealers + 656 posts - small enough to migrate easily
Python scripts total ~5000 lines - significant effort to convert
Most critical: Email sending (used by 4 routes, blocks core workflows)
EXISTING WORKAROUNDS
The CLAUDE.md documentation already notes:

"Sync from Excel" is marked LOCAL ONLY in documentation
Excel sync button includes caveat: "works on localhost, not Vercel production"
Manual sync instructions provided for terminal use
Current State: The team knows about these limitations and runs admin operations from localhost.

Stayed in plan mode
You're right - let me verify if it's truly just the Excel sync issues or if there are other blockers. I'll do a focused analysis on what remains broken after we account for the Excel sync.

What WON'T Work on Vercel (Summary)
❌ Excel Sync - THE PRIMARY BLOCKER
Only ONE route is truly broken: /api/admin/sync-excel

Why it fails:

Spawns sync_from_excel.py which reads Excel from: /mnt/c/Users/GregWood/OneDrive - woodhouseagency.com/...
This WSL-mounted OneDrive path doesn't exist on Vercel
Impact:

Can't add NEW dealers from Allied Excel
Can't bulk-update dealer fields from Excel
Can't detect removed dealers
⚠️ Downstream Effects (Data Staleness)
Everything else technically works but operates on stale data:

124 existing FULL dealers are fine
New dealers after last sync won't exist
Field updates from Excel won't be reflected
✅ What DOES Work Independently
These operations work perfectly without Excel sync:

Email sending - Reads from SQLite, calls Resend API directly
Logo management - UI saves, uploads to Drive
Post submissions - Independent writes to posts table
Dealer status changes - Gmail webhook promotions/demotions
Batch rendering - Creatomate API with existing dealer data
Spreadsheet operations - Google Sheets API direct calls
Solutions to Overcome Excel Sync
Let me analyze the best approaches:

What WON'T Work on Vercel (Summary)
❌ Excel Sync - THE PRIMARY BLOCKER
Only ONE route is truly broken: /api/admin/sync-excel

Why it fails:

Spawns sync_from_excel.py which reads Excel from: /mnt/c/Users/GregWood/OneDrive - woodhouseagency.com/...
This WSL-mounted OneDrive path doesn't exist on Vercel
Impact:

Can't add NEW dealers from Allied Excel
Can't bulk-update dealer fields from Excel
Can't detect removed dealers
⚠️ Downstream Effects (Data Staleness)
Everything else technically works but operates on stale data:

124 existing FULL dealers are fine
New dealers after last sync won't exist
Field updates from Excel won't be reflected
✅ What DOES Work Independently
These operations work perfectly without Excel sync:

Email sending - Reads from SQLite, calls Resend API directly
Logo management - UI saves, uploads to Drive
Post submissions - Independent writes to posts table
Dealer status changes - Gmail webhook promotions/demotions
Batch rendering - Creatomate API with existing dealer data
Spreadsheet operations - Google Sheets API direct calls
Solutions to Overcome Excel Sync
Let me analyze the best approaches: